{% extends "base.html" %}
{% load static %}

{% block title %}Calend√°rio de Eventos - NEABI{% endblock %}

{% block content %}

<!-- FullCalendar -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.14/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.14/index.global.min.js"></script>

<!-- CSS externo -->
<link rel="stylesheet" href="{% static 'css/calendar.css' %}">

<section class="py-16 px-4 sm:px-6 lg:px-8">
  <div class="max-w-7xl mx-auto">

    <h1 class="text-4xl font-extrabold text-center mb-10">
      <span class="bg-gradient-to-r from-amber-600 to-red-700 bg-clip-text text-transparent">
        Calend√°rio Geral de Eventos do NEABI
      </span>
    </h1>

    <p class="text-center text-gray-600 text-lg max-w-2xl mx-auto mb-8">
      Acompanhe todos os eventos e programa√ß√µes do NEABI em um calend√°rio moderno, interativo e atualizado.
    </p>

    <!-- CALEND√ÅRIO -->
    <div class="shadow-lg rounded-xl bg-white p-4">
      <div id="calendar"></div>
    </div>


    <!-- ==================== MODAL CORRIGIDO ==================== -->
    <div id="modalEvento" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">

      <div class="bg-white p-6 rounded-xl shadow-xl w-full max-w-lg"
           onclick="event.stopPropagation()">

        <h2 id="modalTitulo" class="text-2xl font-bold mb-2"></h2>

        <p id="modalData" class="text-gray-600 text-sm mb-3"></p>

        <div id="modalDescricao" class="text-gray-700 mb-4"></div>

        <p class="text-sm text-gray-600 mb-1">
          <strong>Local:</strong> <span id="modalLocal"></span>
        </p>

        <p class="text-sm text-gray-600 mb-4">
          <strong>Hor√°rio:</strong> <span id="modalHora"></span>
        </p>

        <div class="flex justify-end gap-3">
          <a id="modalLink"
            href="#"
            class="bg-amber-600 text-white px-4 py-2 rounded-lg hover:bg-amber-700">Ver detalhes</a>

          <button onclick="fecharModal()"
                  class="px-4 py-2 bg-gray-300 rounded-lg hover:bg-gray-400">Fechar</button>
        </div>
      </div>
    </div>

  </div>
</section>


<!-- ==================== SCRIPT COMPLETO ==================== -->
<script>

document.addEventListener('DOMContentLoaded', function () {

    var calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
        initialView: 'dayGridMonth',
        locale: 'pt-br',
        height: "auto",

        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,dayGridWeek,listMonth'
        },

        buttonText: {
            today: "Hoje",
            month: "M√™s",
            week: "Semana",
            day: "Dia",
            list: "Lista"
        },

        /* üîπ TEXTO QUANDO N√ÉO H√Å EVENTOS */
        noEventsContent: "Nenhum evento para exibir",

        views: {
            dayGridMonth: { allDaySlot: false },
            dayGridWeek: { allDaySlot: false }
        },

        events: {
            url: '/api/eventos/',
            method: 'GET',
            failure: (e) => console.error("Erro ao carregar eventos", e)
        },

        eventClick: function(info) {
            if (info.event.url) {
                window.location.href = info.event.url;
            }
        },

        eventDidMount: function(info) {
            if (info.event.allDay) {
                const timeEl = info.el.querySelector('.fc-event-time');
                if (timeEl) timeEl.innerText = 'Dia Inteiro';
            }
        }
    });

    calendar.render();
});
/* ==================== MODAL ==================== */

function abrirModal(event) {
    const modal = document.getElementById('modalEvento');
    modal.classList.remove("hidden");

    document.getElementById('modalTitulo').innerText = event.title;

    const data = new Date(event.start);
    document.getElementById('modalData').innerText =
        data.toLocaleDateString('pt-BR', {
            weekday: "long",
            day: "2-digit",
            month: "long",
            year: "numeric"
        });

    document.getElementById('modalDescricao').innerHTML =
        event.extendedProps.description || "<em>Sem descri√ß√£o dispon√≠vel.</em>";

    document.getElementById('modalLocal').innerText =
        event.extendedProps.location || "N√£o informado";

    document.getElementById('modalHora').innerText =
        formatarHora(event.start);

    document.getElementById('modalLink').href =
        event.extendedProps.url || "#";
}

function fecharModal() {
    document.getElementById('modalEvento').classList.add("hidden");
}

function formatarHora(dateStr) {
    const dt = new Date(dateStr);
    return dt.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
}
</script>

{% endblock %}
